# ログマクロ（Logging macros）

テストケース中に、追加のメッセージを安全にログ出力することができます（[**スレッド内でも安全**](faq.md#is-doctest-thread-aware)です）。

---

## `INFO()`

```INFO()``` マクロは、カンマ区切りで複数の式を並べることで、それらをキャプチャしてログ出力します：

```cpp
INFO("数値は ", i);
```

このメッセージは、**そのスコープ内、もしくはネストされたスコープ内のすべてのアサート**に関連付けられます。  
実際の出力は、アサートが失敗したときにのみ表示されます。

> **重要：** `INFO()` に渡した式は即時評価されず、アサートが失敗したときに**遅延評価**されます。

---

### 補足事項：

- 遅延評価されるため、変数の値がアサート時点で変わっている可能性があります。
- 型の文字列化（stringification）については[こちら](stringification.md)を参照してください。

このように `INFO()` は非常に軽量なので、ループ内などでも安心して使えます。  
たとえば、繰り返し処理のイテレーション番号を出力する用途に適しています。

---

## `CAPTURE()`

```CAPTURE()``` は `INFO()` のラッパーマクロで、**変数名付きでログを出力する**ための便利な構文です。

```cpp
CAPTURE(some_variable);
```

上記のように記述すると、以下のような出力になります：

```text
  some_variable := 42
```

※ 実際には変数でなくても任意の式が使えます。

---

## テストを失敗させるログマクロ

以下のマクロは、メッセージ出力に加えてテスト失敗として扱うことができます：

- `MESSAGE(message)`：単にメッセージを出力（テストは失敗扱いにはならない）
- `FAIL_CHECK(message)`：`CHECK()` と同様に、テストは失敗とされるが実行は継続
- `FAIL(message)`：`REQUIRE()` と同様に、即座にテストを中断して失敗とする

### 使用例：

```cpp
FAIL("想定外の状態です！変数の値: ", var);
```

> `INFO()` とは異なり、これらは**遅延評価されず即時評価される**ため、渡した値はすぐに文字列化・出力されます。

---

## 外部ライブラリ向けマクロ

モックフレームワークなど、外部ライブラリとの統合用に次のようなマクロも用意されています：

- `ADD_MESSAGE_AT(file, line, message)`
- `ADD_FAIL_CHECK_AT(file, line, message)`
- `ADD_FAIL_AT(file, line, message)`

これらは、doctest の外で検出された失敗を、doctest のテスト結果に組み込みたい場合に便利です。

---

- 多くのマクロの実例は、[**このサンプルコード**](../../examples/all_features/logging.cpp)をご覧ください。

---

[ホームに戻る](readme.md#reference)
