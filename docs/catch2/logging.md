# ロギングマクロ（Logging macros）

テストケース中に追加のメッセージを記録（ログ）することができます。  
ただし、`INFO` マクロで記録したメッセージはスコープに依存するため、そのメッセージの前に失敗が発生した場合は表示されません。以下に例を示します：

```cpp
TEST_CASE("Foo") {
    INFO("テストケースの開始");
    for (int i = 0; i < 2; ++i) {
        INFO("数値は " << i);
        CHECK(i == 0);
    }
}

TEST_CASE("Bar") {
    INFO("テストケースの開始");
    for (int i = 0; i < 2; ++i) {
        INFO("数値は " << i);
        CHECK(i == i);
    }
    CHECK(false);
}
```

"Foo" テストケースで `CHECK` が失敗した場合、次の2つのメッセージが出力されます：

```
テストケースの開始
数値は 1
```

一方、"Bar" テストケースで最後の `CHECK` が失敗した場合は、次の1つのみが出力されます：

```
テストケースの開始
```

---

## スコープに依存しないログ出力

> [Catch 2.7.0 で導入されました](https://github.com/catchorg/Catch2/issues/1522)

`UNSCOPED_INFO` は `INFO` に似ていますが、以下の2点が異なります：

- スコープに依存せずメッセージが保持されます。
- その直後に実行されるアサーション1つだけがそのメッセージを報告します（成功／失敗に関係なく）。

つまり、`UNSCOPED_INFO` の有効期間は「次のアサーション」または「セクション／テストケースの終了」までのどちらか早い方です。  
一方、`INFO` は定義されたスコープの終わりまで有効です。

この違いにより、ヘルパー関数や内部スコープから情報を出力したい場合に便利です。

```cpp
void print_some_info() {
    UNSCOPED_INFO("ヘルパーからの情報");
}

TEST_CASE("Baz") {
    print_some_info();
    for (int i = 0; i < 2; ++i) {
        UNSCOPED_INFO("数値は " << i);
    }
    CHECK(false);
}

TEST_CASE("Qux") {
    INFO("1つ目の INFO");
    UNSCOPED_INFO("1つ目の UNSCOPED_INFO");
    CHECK(false);

    INFO("2つ目の INFO");
    UNSCOPED_INFO("2つ目の UNSCOPED_INFO");
    CHECK(false);
}
```

"**Baz**" テストケースでは次の出力が得られます：

```
ヘルパーからの情報
数値は 0
数値は 1
```

"**Qux**" テストケースの1つ目の `CHECK` で失敗した場合は次の2行が出力されます：

```
1つ目の INFO
1つ目の UNSCOPED_INFO
```

その後、"1つ目の UNSCOPED_INFO" はクリアされますが、"1つ目の INFO" はテストケース終了まで保持されるため、2つ目の `CHECK` が失敗した場合は次の3行が出力されます：

```
1つ目の INFO
2つ目の INFO
2つ目の UNSCOPED_INFO
```

---

## ストリーミングマクロ

すべてのロギングマクロでは、`std::ostream` や `std::cout` と同様に `<<` 演算子を使って値を連結できます。

例：
```c++
INFO( "数値は " << i );
```

（`<<` は使いますが、マクロの引数は括弧で囲み、先頭に `<<` は不要です）

ロギングマクロには以下の種類があります：

---

**INFO(** _メッセージ式_ **)**

- メッセージはバッファに記録されます。
- 次のアサーションで失敗が発生したときのみ出力されます（成功時は表示されません）。
- スコープ終了時にバッファから削除されます。
- ループ内での使用にも適しています。

> Catch2 v2.x.x では `INFO` にセミコロンは不要ですが、将来のバージョンではマクロ内のセミコロンが削除されるため、**末尾にセミコロンを付けることが推奨されます**。

---

**UNSCOPED_INFO(** _メッセージ式_ **)**

> [Catch 2.7.0 で導入されました](https://github.com/catchorg/Catch2/issues/1522)

- `INFO` と同様ですが、メッセージはスコープに依存せず保持されます。
- 各アサーションまたはセクション／テストケース終了時にバッファから削除されます。

---

**WARN(** _メッセージ式_ **)**

- メッセージを常に表示しますが、テストは失敗しません。

---

**FAIL(** _メッセージ式_ **)**

- メッセージを表示し、テストケースを失敗させます。

---

**FAIL_CHECK(** _メッセージ式_ **)**

- `FAIL` と同様ですが、テストを中断せずに続行します。

---

## 変数や式の値をすばやく記録する

**CAPTURE(** _式1_, _式2_, ... **)**

変数や式の値をログに残したいときに便利です。  
`CAPTURE` マクロは、変数名／式とその評価結果を自動で記録してくれます。

例：

```cpp
int a = 1, b = 2, c = 3;
CAPTURE( a, b, c, a + b, c > b, a == 1 );
```

この場合、次のようなログが出力されます：

```
a := 1
b := 2
c := 3
a + b := 3
c > b := true
a == 1 := true
```

カンマを含む関数呼び出しやテンプレート式なども、括弧で囲めば記録可能です：

```cpp
CAPTURE( (std::pair<int, int>{1, 2}) );
```

---

[ホームへ戻る](Readme.md)
